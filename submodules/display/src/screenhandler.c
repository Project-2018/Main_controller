/*
    ChibiOS - Copyright (C) 2006..2016 Giovanni Di Sirio

    Licensed under the Apache License, Version 2.0 (the "License@    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/

#include "ch.h"
#include "hal.h"
#include "screenhandler.h"
#include "serial_comm.h"
#include "screeninfo_cfg.h"

#define WELCOME_SCREEN_TIMEOUT_MS 1000
#define NUM_STATES 8
#define DEFAULT_LIFTING_SPEED 2

#define YEAR_MAX  2038
#define YEAR_MIN  1970
#define YEAR_LEAP 1968

    //Screen commands
    static uint8_t screen_welcome[]        = {0x70, 0x61, 0x67, 0x65, 0x20, 0x30, 0xFF, 0xFF, 0xFF};  
    static uint8_t screen_main[]           = {0x70, 0x61, 0x67, 0x65, 0x20, 0x31, 0xFF, 0xFF, 0xFF};
   // static uint8_t screen_menu[]           = {0x70, 0x61, 0x67, 0x65, 0x20, 0x32, 0xFF, 0xFF, 0xFF};
   // static uint8_t screen_calib_warn[]     = {0x70, 0x61, 0x67, 0x65, 0x20, 0x33, 0xFF, 0xFF, 0xFF};
   // static uint8_t screen_calib_progress[] = {0x70, 0x61, 0x67, 0x65, 0x20, 0x34, 0xFF, 0xFF, 0xFF};
   // static uint8_t screen_calib_ok[]       = {0x70, 0x61, 0x67, 0x65, 0x20, 0x35, 0xFF, 0xFF, 0xFF};
   // static uint8_t screen_calib_err[]      = {0x70, 0x61, 0x67, 0x65, 0x20, 0x36, 0xFF, 0xFF, 0xFF};
   // static uint8_t screen_config[]         = {0x70, 0x61, 0x67, 0x65, 0x20, 0x37, 0xFF, 0xFF, 0xFF};
    static uint8_t screen_overload_warn[]  = {0x70, 0x61, 0x67, 0x65, 0x20, 0x38, 0xFF, 0xFF, 0xFF};
    static uint8_t screen_overtemp_warn[]  = {0x70, 0x61, 0x67, 0x65, 0x20, 0x39, 0xFF, 0xFF, 0xFF};
    static uint8_t screen_overtilt_warn[]  = {0x70, 0x61, 0x67, 0x65, 0x20, 0x31, 0x30, 0xFF, 0xFF, 0xFF};
    static uint8_t screen_charge[]         = {0x70, 0x61, 0x67, 0x65, 0x20, 0x31, 0x31, 0xFF, 0xFF, 0xFF};
    static uint8_t screen_sysinfo[]        = {0x70, 0x61, 0x67, 0x65, 0x20, 0x31, 0x32, 0xFF, 0xFF, 0xFF};

    static uint8_t rxbutton_config_metric[]           =   {0x65, 0x07, 0x12, 0x00, 0xFF, 0xFF, 0xFF};
    static uint8_t rxbutton_config_imperial[]         =   {0x65, 0x07, 0x13, 0x00, 0xFF, 0xFF, 0xFF};
    static uint8_t rxbutton_config_meas[]             =   {0x65, 0x07, 0x17, 0x00, 0xFF, 0xFF, 0xFF};
    static uint8_t rxbutton_turt[]                    =   {0x65, 0x01, 0x04, 0x00, 0xFF, 0xFF, 0xFF}; 
    static uint8_t rxbutton_rabb[]                    =   {0x65, 0x01, 0x03, 0x00, 0xFF, 0xFF, 0xFF};
    static uint8_t rxbutton_config_date_yyyy_plus[]   =   {0x65, 0x07, 0x04, 0x00, 0xFF, 0xFF, 0xFF};
    static uint8_t rxbutton_config_date_yyyy_minus[]  =   {0x65, 0x07, 0x08, 0x00, 0xFF, 0xFF, 0xFF};
    static uint8_t rxbutton_config_date_mm_plus[]     =   {0x65, 0x07, 0x05, 0x00, 0xFF, 0xFF, 0xFF};
    static uint8_t rxbutton_config_date_mm_minus[]    =   {0x65, 0x07, 0x03, 0x00, 0xFF, 0xFF, 0xFF};
    static uint8_t rxbutton_config_date_dd_plus[]     =   {0x65, 0x07, 0x02, 0x00, 0xFF, 0xFF, 0xFF};
    static uint8_t rxbutton_config_date_dd_minus[]    =   {0x65, 0x07, 0x09, 0x00, 0xFF, 0xFF, 0xFF};
    static uint8_t rxbutton_config_time_hh_plus[]     =   {0x65, 0x07, 0x06, 0x01, 0xFF, 0xFF, 0xFF};
    static uint8_t rxbutton_config_time_hh_minus[]    =   {0x65, 0x07, 0x0A, 0x01, 0xFF, 0xFF, 0xFF};
    static uint8_t rxbutton_config_time_mm_plus[]     =   {0x65, 0x07, 0x07, 0x00, 0xFF, 0xFF, 0xFF};
    static uint8_t rxbutton_config_time_mm_minus[]    =   {0x65, 0x07, 0x0B, 0x00, 0xFF, 0xFF, 0xFF};

    static uint8_t overtilt_on[] = {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x74, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0xFF, 0xFF, 0xFF};
    static uint8_t overtilt_off[] = {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x74, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x30, 0xFF, 0xFF, 0xFF};
    static uint8_t init_weight_lbs[] = {0x76, 0x61, 0x32, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0xff, 0xff, 0xff};
    static uint8_t init_weight_kgs[] = {0x76, 0x61, 0x32, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x32, 0xff, 0xff, 0xff};
    static uint8_t lifting_spd[][17] =  {
     {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x76, 0x61, 0x30, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x30, 0xff, 0xff, 0xff},
     {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x76, 0x61, 0x30, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0xff, 0xff, 0xff},
     {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x76, 0x61, 0x30, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x32, 0xff, 0xff, 0xff},
     {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x76, 0x61, 0x30, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x33, 0xff, 0xff, 0xff}
    };


    static uint8_t battery[][18] ={
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x62, 0x61, 0x74, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x30, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x62, 0x61, 0x74, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x62, 0x61, 0x74, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x32, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x62, 0x61, 0x74, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x33, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x62, 0x61, 0x74, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x34, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x62, 0x61, 0x74, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x62, 0x61, 0x74, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x36, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x62, 0x61, 0x74, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x37, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x62, 0x61, 0x74, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x38, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x62, 0x61, 0x74, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x39, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x62, 0x61, 0x74, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x39, 0xFF, 0xFF, 0xFF},

        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x62, 0x61, 0x74, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0x30, 0xFF, 0xFF, 0xFF}
    };

    static uint8_t clock_hh[][16] = {
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x68, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x30, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x68, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x68, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x32, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x68, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x33, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x68, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x34, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x68, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x68, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x36, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x68, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x37, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x68, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x38, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x68, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x39, 0xFF, 0xFF, 0xFF},

        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x68, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0x30, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x68, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0x31, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x68, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0x32, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x68, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0x33, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x68, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0x34, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x68, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0x35, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x68, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0x36, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x68, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0x37, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x68, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0x38, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x68, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0x39, 0xFF, 0xFF, 0xFF},

        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x68, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x32, 0x30, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x68, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x32, 0x31, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x68, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x32, 0x32, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x68, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x32, 0x33, 0xFF, 0xFF, 0xFF}
    };

    static uint8_t clock_mm[][16]  = {
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x30, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x32, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x33, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x34, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x36, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x37, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x38, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x39, 0xFF, 0xFF, 0xFF},

        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0x30, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0x31, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0x32, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0x33, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0x34, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0x35, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0x36, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0x37, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0x38, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0x39, 0xFF, 0xFF, 0xFF},

        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x32, 0x30, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x32, 0x31, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x32, 0x32, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x32, 0x33, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x32, 0x34, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x32, 0x35, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x32, 0x36, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x32, 0x37, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x32, 0x38, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x32, 0x39, 0xFF, 0xFF, 0xFF},

        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x33, 0x30, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x33, 0x31, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x33, 0x32, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x33, 0x33, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x33, 0x34, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x33, 0x35, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x33, 0x36, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x33, 0x37, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x33, 0x38, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x33, 0x39, 0xFF, 0xFF, 0xFF},

        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x34, 0x30, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x34, 0x31, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x34, 0x32, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x34, 0x33, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x34, 0x34, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x34, 0x35, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x34, 0x36, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x34, 0x37, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x34, 0x38, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x34, 0x39, 0xFF, 0xFF, 0xFF},

        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0x30, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0x31, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0x32, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0x33, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0x34, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0x35, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0x36, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0x37, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0x38, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0x39, 0xFF, 0xFF, 0xFF}
    };

    static uint8_t years[][16]  = {
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x30, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x32, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x33, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x34, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x36, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x37, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x38, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x39, 0xFF, 0xFF, 0xFF},

        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0x30, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0x31, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0x32, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0x33, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0x34, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0x35, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0x36, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0x37, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0x38, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0x39, 0xFF, 0xFF, 0xFF},

        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x32, 0x30, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x32, 0x31, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x32, 0x32, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x32, 0x33, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x32, 0x34, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x32, 0x35, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x32, 0x36, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x32, 0x37, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x32, 0x38, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x32, 0x39, 0xFF, 0xFF, 0xFF},

        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x33, 0x30, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x33, 0x31, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x33, 0x32, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x33, 0x33, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x33, 0x34, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x33, 0x35, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x33, 0x36, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x33, 0x37, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x33, 0x38, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x33, 0x39, 0xFF, 0xFF, 0xFF},

        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x34, 0x30, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x34, 0x31, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x34, 0x32, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x34, 0x33, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x34, 0x34, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x34, 0x35, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x34, 0x36, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x34, 0x37, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x34, 0x38, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x34, 0x39, 0xFF, 0xFF, 0xFF},

        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0x30, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0x31, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0x32, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0x33, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0x34, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0x35, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0x36, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0x37, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0x38, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0x39, 0xFF, 0xFF, 0xFF},

        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x36, 0x30, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x36, 0x31, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x36, 0x32, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x36, 0x33, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x36, 0x34, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x36, 0x35, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x36, 0x36, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x36, 0x37, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x79, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x36, 0x38, 0xFF, 0xFF, 0xFF}
    };

    static uint8_t months[][17]  = {
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x6F, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x30, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x6F, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x6F, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x32, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x6F, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x33, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x6F, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x34, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x6F, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x6F, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x36, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x6F, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x37, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x6F, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x38, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x6F, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x39, 0xFF, 0xFF, 0xFF},

        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x6F, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0x30, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x6F, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0x31, 0xFF, 0xFF, 0xFF}
    };

    static uint8_t days[][16]  = {
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x64, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x30, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x64, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x64, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x32, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x64, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x33, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x64, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x34, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x64, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x64, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x36, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x64, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x37, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x64, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x38, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x64, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x39, 0xFF, 0xFF, 0xFF},

        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x64, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0x30, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x64, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0x31, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x64, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0x32, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x64, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0x33, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x64, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0x34, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x64, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0x35, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x64, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0x36, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x64, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0x37, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x64, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0x38, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x64, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0x39, 0xFF, 0xFF, 0xFF},

        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x64, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x32, 0x30, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x64, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x32, 0x31, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x64, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x32, 0x32, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x64, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x32, 0x33, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x64, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x32, 0x34, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x64, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x32, 0x35, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x64, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x32, 0x36, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x64, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x32, 0x37, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x64, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x32, 0x38, 0xFF, 0xFF, 0xFF},
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x64, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x32, 0x39, 0xFF, 0xFF, 0xFF},

        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x64, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x33, 0x30, 0xFF, 0xFF, 0xFF}
    };

    static uint8_t weight_100[][17] = {
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x77, 0x31, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x36, 0x31, 0xFF, 0xFF, 0xFF}, //0
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x77, 0x31, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0x30, 0xFF, 0xFF, 0xFF}, //
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x77, 0x31, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0x31, 0xFF, 0xFF, 0xFF}, //
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x77, 0x31, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0x32, 0xFF, 0xFF, 0xFF}, //
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x77, 0x31, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0x33, 0xFF, 0xFF, 0xFF}, //
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x77, 0x31, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0x34, 0xFF, 0xFF, 0xFF}, //
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x77, 0x31, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0x35, 0xFF, 0xFF, 0xFF}, //
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x77, 0x31, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0x36, 0xFF, 0xFF, 0xFF}, //
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x77, 0x31, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0x37, 0xFF, 0xFF, 0xFF}, //
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x77, 0x31, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0x38, 0xFF, 0xFF, 0xFF}, //
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x77, 0x31, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0x39, 0xFF, 0xFF, 0xFF}  //9
    };

    static uint8_t weight_10[][17] = {
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x77, 0x32, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x36, 0x30, 0xFF, 0xFF, 0xFF}, //0
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x77, 0x32, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0x30, 0xFF, 0xFF, 0xFF}, //
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x77, 0x32, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0x31, 0xFF, 0xFF, 0xFF}, //
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x77, 0x32, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0x32, 0xFF, 0xFF, 0xFF}, //
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x77, 0x32, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0x33, 0xFF, 0xFF, 0xFF}, //
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x77, 0x32, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0x34, 0xFF, 0xFF, 0xFF}, //
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x77, 0x32, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0x35, 0xFF, 0xFF, 0xFF}, //
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x77, 0x32, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0x36, 0xFF, 0xFF, 0xFF}, //
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x77, 0x32, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0x37, 0xFF, 0xFF, 0xFF}, //
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x77, 0x32, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0x38, 0xFF, 0xFF, 0xFF}, //
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x77, 0x32, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0x39, 0xFF, 0xFF, 0xFF},  //9
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x77, 0x32, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x36, 0x31, 0xFF, 0xFF, 0xFF} //mpty
    };

    static uint8_t weight_1[][17] = {
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x77, 0x33, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x36, 0x30, 0xFF, 0xFF, 0xFF}, //0
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x77, 0x33, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0x30, 0xFF, 0xFF, 0xFF}, //0
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x77, 0x33, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0x31, 0xFF, 0xFF, 0xFF}, //0
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x77, 0x33, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0x32, 0xFF, 0xFF, 0xFF}, //0
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x77, 0x33, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0x33, 0xFF, 0xFF, 0xFF}, //0
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x77, 0x33, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0x34, 0xFF, 0xFF, 0xFF}, //0
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x77, 0x33, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0x35, 0xFF, 0xFF, 0xFF}, //0
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x77, 0x33, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0x36, 0xFF, 0xFF, 0xFF}, //0
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x77, 0x33, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0x37, 0xFF, 0xFF, 0xFF}, //0
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x77, 0x33, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0x38, 0xFF, 0xFF, 0xFF}, //0
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x77, 0x33, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x35, 0x39, 0xFF, 0xFF, 0xFF} //0
    };

    static uint8_t arr_measunit[][16] = {
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x75, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x30, 0xFF, 0xFF, 0xFF}, //0
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x75, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x31, 0xFF, 0xFF, 0xFF}, //0
        {0x6D, 0x61, 0x69, 0x6E, 0x2E, 0x6D, 0x75, 0x2E, 0x76, 0x61, 0x6C, 0x3D, 0x32, 0xFF, 0xFF, 0xFF} //0
    };

  //state_machine_t sm;
  //event_t event;
  screen_variables screenvar;
  screen_variables lastvar;
  bool overtemp_flag = false;
  bool overtilt_flag = false;
  bool overweight_flag = false;
  bool charge_flag = false;

  //This function watches the inputs and returns the correct event happened eg. touch on screen, tilt on the forklift, etc.
  void StateMachine_GetEvent(void) {
    uint8_t *charbuf;
    charbuf = getbuf();

    //Charge event (L1 -Most important)
    if(screenvar.ischarging == true && charge_flag == false){
      charge_flag = true;
      sendbuf(&screen_charge,10);
    }
    
    if(screenvar.ischarging == false && charge_flag == true){
      charge_flag = false;
      sendbuf(&screen_main,9);
    }
    //Overtemperature event (L2)
    if(screenvar.overtemp == true && overtemp_flag == false && screenvar.ischarging == false){
      overtemp_flag = true;
      sendbuf(&screen_overtemp_warn,9);
    }

    if(screenvar.overtemp == false && overtemp_flag == true){
      overtemp_flag = false;
      sendbuf(&screen_main,9);
    }

    //Overtilt event (L3)
    if(screenvar.overtilt == true && overtilt_flag == false && screenvar.ischarging == false && screenvar.overtemp == false){
      overtilt_flag = true;
      sendbuf(&overtilt_on,15);
      chThdSleepMilliseconds(3);
      sendbuf(&screen_overtilt_warn,10);

    }

    if(screenvar.overtilt == false && overtilt_flag == true){
      overtilt_flag = false;
      sendbuf(&overtilt_off,15);
      chThdSleepMilliseconds(3);
      sendbuf(&screen_main,9);
    }

    //Overload event (L4 -Least important)
    if(screenvar.overweight == true && overweight_flag == false && screenvar.ischarging == false && screenvar.overtemp == false && screenvar.overtilt == false){
      overweight_flag = true;
      sendbuf(&screen_overload_warn,9);
    }

    if(screenvar.overweight == false && overweight_flag == true){
      overweight_flag = false;
      sendbuf(&screen_main,9);
    }

    if(charbuf[0] != 0x00){
      //main screen related events
       if (bufcmp(charbuf, rxbutton_rabb)){
        zerobuf();
        if(screenvar.lift_speed < 3) {
          screenvar.lift_speed++;
        } else {
          screenvar.lift_speed = 3;
        }
      }
      else if (bufcmp(charbuf, rxbutton_turt)){
        zerobuf();
        if(screenvar.lift_speed > 1) {
          screenvar.lift_speed--;
        } else {
          screenvar.lift_speed = 1;
        }
      }

      //configuration related
      else if (bufcmp(charbuf, rxbutton_config_date_yyyy_plus)){
        zerobuf();
        if(screenvar.date_yyyy < YEAR_MAX){
          screenvar.date_yyyy++;
        }
      }

      else if (bufcmp(charbuf, rxbutton_config_date_yyyy_minus)){
        zerobuf();
        if(screenvar.date_yyyy > YEAR_MIN){
          screenvar.date_yyyy--;
        }
      }

      else if (bufcmp(charbuf, rxbutton_config_date_mm_plus)){
        zerobuf();
        if(screenvar.date_mm < 12)  
          screenvar.date_mm++;
      }

      else if (bufcmp(charbuf, rxbutton_config_date_mm_minus)){
        zerobuf();
        if(screenvar.date_mm > 1)
          screenvar.date_mm--;
      }

      else if (bufcmp(charbuf, rxbutton_config_date_dd_plus)){
        zerobuf();
        if(screenvar.date_mm == 1 || screenvar.date_mm == 3 || screenvar.date_mm == 5 || screenvar.date_mm == 7 || screenvar.date_mm == 8 || screenvar.date_mm == 10 || screenvar.date_mm == 12){
          if(screenvar.date_dd < 31){
            screenvar.date_dd++;
          } else {
            screenvar.date_dd=31;
          }
        }
        if(screenvar.date_mm == 4 || screenvar.date_mm == 6 || screenvar.date_mm == 9 || screenvar.date_mm == 11){
          if(screenvar.date_dd < 30){
            screenvar.date_dd++;
          }else {
            screenvar.date_dd=30;
          }

        }
        if(screenvar.date_mm == 2){
          if((screenvar.date_yyyy-YEAR_LEAP)%4 == 0){
            if(screenvar.date_dd < 29) screenvar.date_dd++;
          } else {
            if(screenvar.date_dd < 28) screenvar.date_dd++;
          }
        }
      }

    else if (bufcmp(charbuf, rxbutton_config_date_dd_minus)){
      zerobuf();
      if(screenvar.date_dd > 1)
        screenvar.date_dd--;
    }

    else if (bufcmp(charbuf, rxbutton_config_time_hh_plus)){
      zerobuf();
      if(screenvar.time_hh < 23){
        screenvar.time_hh++;
      }else {
      screenvar.time_hh = 0;
      }
    }

    else if (bufcmp(charbuf, rxbutton_config_time_hh_minus)){
      zerobuf();
      if(screenvar.time_hh > 0){
        screenvar.time_hh--;
      }else{
        screenvar.time_hh=23;
      }
    }

    else if (bufcmp(charbuf, rxbutton_config_time_mm_plus)){
      zerobuf();
      if(screenvar.time_mm < 59){
      screenvar.time_mm++;
      }else {
        screenvar.time_mm = 0;
      }
    }

    else if (bufcmp(charbuf, rxbutton_config_time_mm_minus)){
      zerobuf();
      if(screenvar.time_mm > 0){
        screenvar.time_mm--;
      } else {
        screenvar.time_mm=59;
      }
    }

    //measunit
    else if (bufcmp(charbuf, rxbutton_config_metric)){
      zerobuf();
      screenvar.meas_unit = 1;
    }
    
    else if (bufcmp(charbuf, rxbutton_config_imperial)){
      zerobuf();
      screenvar.meas_unit = 2;
    }

    }
  }   

  //A thread that keeps the screen updated
static THD_WORKING_AREA(ScreenhandlerTask_wa, 128);
static THD_FUNCTION(ScreenhandlerTask, p) {

  (void)p;
      //palSetPad(GPIOA, GPIOA_LED_GREEN);
      chThdSleepMilliseconds(50);
      screen_fetch_info();
      chRegSetThreadName("ScreenHandler task");
      while (TRUE) {
        StateMachine_GetEvent();
        chThdSleepMilliseconds(10);
        //screen_refresh();
      }
    }

  //A thread that keeps the screen updated
static THD_WORKING_AREA(ScreenUpdaterTask_wa, 128);
static THD_FUNCTION(ScreenUpdaterTask, p) {

  (void)p;
      //palSetPad(GPIOA, GPIOA_LED_GREEN);
      chThdSleepMilliseconds(500);
      //screen_fetch_info();
      chRegSetThreadName("Screenupdater task");
      while (TRUE) {
        screen_refresh();
        screen_fetch_info();
        chThdSleepMilliseconds(50);
      }
    }



  //A thread that keeps the screen updated
static THD_WORKING_AREA(ScreenUpdaterTask2_wa, 128);
static THD_FUNCTION(ScreenUpdaterTask2, p) {

  (void)p;
      //palSetPad(GPIOA, GPIOA_LED_GREEN);
      chThdSleepMilliseconds(500);
      //screen_fetch_info();
      chRegSetThreadName("Screenupdater task");
      while (TRUE) {
        
         refresh_weight();
        chThdSleepMilliseconds(5000);
      }
    }
  //A function that initializes the state machine
  void sm_init(void){

    sendbuf(&screen_welcome,9);
  

    //chThdSleepMilliseconds(1000);
    //serialcomm::sendbuf(&sn,getbuflen(sn));
    chThdSleepMilliseconds(1000);

sendbuf(&battery[screenvar.battery_level+1],18);
    chThdSleepMilliseconds(3);
      chThdCreateStatic(ScreenhandlerTask_wa, sizeof(ScreenhandlerTask_wa), NORMALPRIO + 9, ScreenhandlerTask, NULL);
      chThdCreateStatic(ScreenUpdaterTask_wa, sizeof(ScreenUpdaterTask_wa), NORMALPRIO + 1, ScreenUpdaterTask, NULL);
      chThdCreateStatic(ScreenUpdaterTask2_wa, sizeof(ScreenUpdaterTask2_wa), NORMALPRIO + 0, ScreenUpdaterTask2, NULL);
    chThdSleepMilliseconds(20);

    screenvar.lift_speed = DEFAULT_LIFTING_SPEED;
  }

  void sm_main(void){
      sendbuf(&screen_main,9);  
  }



  void sm_overload_warn (void){
    sendbuf(&screen_overload_warn,9);
  }

  void sm_overtemp_warn (void){
    sendbuf(&screen_overtemp_warn,9);
  }

  void sm_overtilt_warn (void){
    sendbuf(&screen_overtilt_warn,10);
  }

  void sm_charge (void){
    sendbuf(&screen_charge,10);
  }

  bool bufcmp(uint8_t* array1, uint8_t* array2){
    int i = 0;
    while (i < (sizeof(array1)/sizeof(uint8_t))){
      if(array1[i] == array2[i]){
        i++;  
      } else {
        break;
      }
    }
    if(i == (sizeof(array1)/sizeof(uint8_t))){
      return true;
    }
    return false;
  }

  bool get_tilt_state(void){
      return false;
  }

  bool get_overtemp_state(void){
      return false;
  }

  bool get_overweight_state(void){
      return false;
  }

  bool get_charge_state(void){
      return false;
  }

  uint8_t get_battery_level(void){
      return 10;
  }

  uint8_t get_meas_unit(void){
      return 1;
  }

  uint16_t get_lifting_weight(void){
      return 500;
  }

  uint8_t get_charge_remaining_state(void){
      return 0;
  }

  uint8_t get_time_hh(void){
      return 1;
  }

  uint8_t get_time_mm(void){
      return 50;
  }

  uint8_t get_date_dd(void){
      return 1;
  }

  uint8_t get_date_mm(void){
      return 1;
  }

  unsigned int get_date_yyyy(void){
      return 1970;
  }

  uint8_t get_calib_result(void){
      return 0;
  }

  char* get_serial_number(void){
      return "0x00000001";
  }

  uint8_t get_lift_speed(void){
      return 1;
  }

  void screen_fetch_info(void){
      //screenvar.readbuf            =    serialcomm::getbuf();
      screenvar.meas_unit          =    FetchMeasUnit();
      screenvar.overtilt           =    FetchTiltState();
      screenvar.overtemp           =    FetchOverTempState();
      screenvar.ischarging         =    FetchChargeState();
      screenvar.overweight         =    FetchOverWeightState();
      screenvar.liftingweight      =    FetchLiftedWeight();
      screenvar.battery_level      =    FetchBatteryLevel();
      screenvar.charge_remaining   =    FetchChargeRemainMinutes();
      screenvar.time_hh            =    FetchHour();
      screenvar.time_mm            =    FetchMinute();
      screenvar.date_dd            =    FetchDay();
      screenvar.date_mm            =    FetchMonth();
      screenvar.date_yyyy          =    FetchYear();
      screenvar.serial_number      =    FetchSerialnumber();
      screenvar.lift_speed         =    FetchLiftingSpeed();
  }

  uint8_t getbuflen(uint8_t array[]){
    //return 12;
    uint8_t i=2;
    while (i<MAX_COMMAND_LEN){
      if(array[i-2] == 0xFF && array[i-1] == 0xFF && array[i] == 0xFF){
        return i+1;
      } 
      i++;
    }
    return 0;
  }

  void screen_refresh(void){
    if(screenvar.date_mm == 4 || screenvar.date_mm == 6 || screenvar.date_mm == 9 || screenvar.date_mm == 11){
    if(screenvar.date_dd > 30)
      screenvar.date_dd=30;
    }

    if(screenvar.date_mm == 2){
    if((screenvar.date_yyyy-YEAR_LEAP)%4 == 0){
      if(screenvar.date_dd > 29){
        screenvar.date_dd =29;
        }
      } else {
        if(screenvar.date_dd > 28)
          screenvar.date_dd = 28;
      }
    }

    sendbuf(&lifting_spd[screenvar.lift_speed],getbuflen(lifting_spd[screenvar.lift_speed])); //fix to make work
    chThdSleepMilliseconds(5);
    sendbuf(&arr_measunit[screenvar.meas_unit],getbuflen(arr_measunit[screenvar.meas_unit])); //fix to make work
    chThdSleepMilliseconds(5);
    weight_send(screenvar.liftingweight);
    sendbuf(&years[screenvar.date_yyyy-YEAR_MIN],getbuflen(years[screenvar.date_yyyy-YEAR_MIN])); //fix to make work
    chThdSleepMilliseconds(5);
    sendbuf(&months[screenvar.date_mm-1],getbuflen(months[screenvar.date_mm-1]));
    chThdSleepMilliseconds(5);
    sendbuf(&days[screenvar.date_dd-1],getbuflen(days[screenvar.date_dd-1]));
    chThdSleepMilliseconds(5);
    sendbuf(&clock_hh[screenvar.time_hh],getbuflen(clock_hh[screenvar.time_hh]));
    chThdSleepMilliseconds(5);
    sendbuf(&clock_mm[screenvar.time_mm],getbuflen(clock_mm[screenvar.time_mm]));
    chThdSleepMilliseconds(5);
  }

  void refresh_weight(void){
    sendbuf(&battery[screenvar.battery_level+1],getbuflen(battery[screenvar.battery_level+1]));
    chThdSleepMilliseconds(3);
  }

  void weight_send(uint16_t weight){
    uint8_t w100=0;
    uint8_t w10=0;
    uint8_t w1=0;

    if(weight > 600) weight = 600;
    if(weight > 0){
      w1 = weight%10;
      weight/=10;
    } 
    if(weight > 0){
      w10 = weight%10;
      weight/=10;
    } 
    if(weight > 0){
      w100 = weight%10;
      weight/=10;
    } 
    if(w10 == 0 && w100 == 0)
      w10=10;

    sendbuf(&weight_100[w100],getbuflen(weight_100[w100]));
        chThdSleepMilliseconds(5);
    sendbuf(&weight_10[w10],getbuflen(weight_10[w10]));
        chThdSleepMilliseconds(5);
    sendbuf(&weight_1[w1],getbuflen(weight_1[w1]));
        chThdSleepMilliseconds(5);

  }

  void setovertempstate(bool isovertemp){
    screenvar.overtemp = isovertemp;
  }

  void setovertiltstate(bool isovertilt){
    screenvar.overtilt = isovertilt;
  }

  void setoverweightstate(bool isoverweight){
    screenvar.overweight = isoverweight;
  }

  void setchargestate(bool chg){
    screenvar.ischarging = chg;
  }

  screen_variables getvariables(void){
    return screenvar;
  }

  const uint8_t getsizeofarr(void){
    return sizeof(rxbutton_turt);
  }